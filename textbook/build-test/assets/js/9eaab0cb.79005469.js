"use strict";(globalThis.webpackChunktextbook=globalThis.webpackChunktextbook||[]).push([[1958],{8375:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"ros2/nodes-topics","title":"ROS 2 Nodes and Topics","description":"This chapter delves deeper into the fundamental communication mechanisms in ROS 2: nodes and topics, which form the backbone of the publish/subscribe communication pattern.","source":"@site/docs/ros2/nodes-topics.md","sourceDirName":"ros2","slug":"/ros2/nodes-topics","permalink":"/docs/ros2/nodes-topics","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ros2/nodes-topics.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"ROS 2 Nodes and Topics"},"sidebar":"textbookSidebar","previous":{"title":"ROS 2 Basics","permalink":"/docs/ros2/basics"},"next":{"title":"Introduction to Digital Twin Simulation","permalink":"/docs/digital-twin/intro"}}');var r=n(4848),l=n(8453);const o={sidebar_label:"ROS 2 Nodes and Topics"},c="ROS 2 Nodes and Topics",a={},t=[{value:"Nodes in Depth",id:"nodes-in-depth",level:2},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"States",id:"states",level:4},{value:"Transition Callbacks",id:"transition-callbacks",level:4},{value:"Node Parameters",id:"node-parameters",level:3},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:3},{value:"Reliability",id:"reliability",level:4},{value:"Durability",id:"durability",level:4},{value:"History",id:"history",level:4},{value:"Topics and Publishers/Subscribers",id:"topics-and-publisherssubscribers",level:2},{value:"Advanced Topic Usage",id:"advanced-topic-usage",level:3},{value:"Creating Publishers",id:"creating-publishers",level:4},{value:"Creating Subscribers",id:"creating-subscribers",level:4},{value:"Message Types",id:"message-types",level:3},{value:"Custom Messages",id:"custom-messages",level:3},{value:"Topic Management",id:"topic-management",level:2},{value:"Topic Information",id:"topic-information",level:3},{value:"Topic Monitoring",id:"topic-monitoring",level:3},{value:"Advanced Communication Patterns",id:"advanced-communication-patterns",level:2},{value:"Publisher-Subscriber Best Practices",id:"publisher-subscriber-best-practices",level:3},{value:"Publisher Guidelines",id:"publisher-guidelines",level:4},{value:"Subscriber Guidelines",id:"subscriber-guidelines",level:4},{value:"Threading and Callbacks",id:"threading-and-callbacks",level:3},{value:"Single-threaded Executor",id:"single-threaded-executor",level:4},{value:"Multi-threaded Executor",id:"multi-threaded-executor",level:4},{value:"Callback Groups",id:"callback-groups",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Message Optimization",id:"message-optimization",level:3},{value:"Topic Design",id:"topic-design",level:3},{value:"Memory Management",id:"memory-management",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:2},{value:"Topic Connection Problems",id:"topic-connection-problems",level:3},{value:"Message Loss",id:"message-loss",level:3},{value:"Performance Issues",id:"performance-issues",level:3}];function d(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"ros-2-nodes-and-topics",children:"ROS 2 Nodes and Topics"})}),"\n",(0,r.jsx)(i.p,{children:"This chapter delves deeper into the fundamental communication mechanisms in ROS 2: nodes and topics, which form the backbone of the publish/subscribe communication pattern."}),"\n",(0,r.jsx)(i.h2,{id:"nodes-in-depth",children:"Nodes in Depth"}),"\n",(0,r.jsx)(i.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,r.jsx)(i.p,{children:"ROS 2 nodes follow a specific lifecycle that provides better control over their state:"}),"\n",(0,r.jsx)(i.h4,{id:"states",children:"States"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Unconfigured"}),": Initial state after creation"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Inactive"}),": Configured but not active"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Active"}),": Running and processing callbacks"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Finalized"}),": Node is being destroyed"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"transition-callbacks",children:"Transition Callbacks"}),"\n",(0,r.jsx)(i.p,{children:"You can define callbacks for state transitions:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_configure()"}),": Called when moving from unconfigured to inactive"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_activate()"}),": Called when moving from inactive to active"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_deactivate()"}),": Called when moving from active to inactive"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_cleanup()"}),": Called when moving from inactive to unconfigured"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_shutdown()"}),": Called when shutting down the node"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"on_error()"}),": Called when an error occurs"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"node-parameters",children:"Node Parameters"}),"\n",(0,r.jsx)(i.p,{children:"Nodes can be configured with parameters:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"# Declare a parameter with default value\nself.declare_parameter('param_name', 'default_value')\n\n# Get parameter value\nparam_value = self.get_parameter('param_name').value\n"})}),"\n",(0,r.jsx)(i.h3,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,r.jsx)(i.p,{children:"QoS settings control how messages are delivered:"}),"\n",(0,r.jsx)(i.h4,{id:"reliability",children:"Reliability"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"Reliable"}),": All messages are delivered (if possible)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"BestEffort"}),": Messages may be dropped"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"durability",children:"Durability"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"Volatile"}),": Only new messages are received"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"TransientLocal"}),": Past messages are available to new subscribers"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"history",children:"History"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"KeepLast"}),": Store a specific number of messages"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"KeepAll"}),": Store all messages (use with caution)"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"topics-and-publisherssubscribers",children:"Topics and Publishers/Subscribers"}),"\n",(0,r.jsx)(i.h3,{id:"advanced-topic-usage",children:"Advanced Topic Usage"}),"\n",(0,r.jsx)(i.h4,{id:"creating-publishers",children:"Creating Publishers"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"# With default QoS\npublisher = self.create_publisher(String, 'topic_name', 10)\n\n# With custom QoS\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\nqos_profile = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10\n)\npublisher = self.create_publisher(String, 'topic_name', qos_profile)\n"})}),"\n",(0,r.jsx)(i.h4,{id:"creating-subscribers",children:"Creating Subscribers"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"# With default QoS\nsubscription = self.create_subscription(\n    String,\n    'topic_name',\n    self.listener_callback,\n    10\n)\n\n# With custom QoS\nsubscription = self.create_subscription(\n    String,\n    'topic_name',\n    self.listener_callback,\n    qos_profile\n)\n"})}),"\n",(0,r.jsx)(i.h3,{id:"message-types",children:"Message Types"}),"\n",(0,r.jsx)(i.p,{children:"ROS 2 supports various built-in message types:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"std_msgs"}),": Basic data types (String, Int32, Float64, etc.)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"geometry_msgs"}),": Geometric primitives (Point, Pose, Twist, etc.)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"sensor_msgs"}),": Sensor data (LaserScan, Image, JointState, etc.)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"nav_msgs"}),": Navigation messages (Odometry, Path, OccupancyGrid, etc.)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"custom-messages",children:"Custom Messages"}),"\n",(0,r.jsx)(i.p,{children:"You can create custom message types:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Define the message in a ",(0,r.jsx)(i.code,{children:".msg"})," file"]}),"\n",(0,r.jsxs)(i.li,{children:["Add message dependencies to ",(0,r.jsx)(i.code,{children:"package.xml"})]}),"\n",(0,r.jsxs)(i.li,{children:["Update ",(0,r.jsx)(i.code,{children:"CMakeLists.txt"})," to build the messages"]}),"\n",(0,r.jsx)(i.li,{children:"Use the generated message type in your code"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"topic-management",children:"Topic Management"}),"\n",(0,r.jsx)(i.h3,{id:"topic-information",children:"Topic Information"}),"\n",(0,r.jsx)(i.p,{children:"Use command-line tools to inspect topics:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# List all topics\nros2 topic list\n\n# Get information about a specific topic\nros2 topic info /topic_name\n\n# Echo messages on a topic\nros2 topic echo /topic_name std_msgs/msg/String\n\n# Publish a message to a topic\nros2 topic pub /topic_name std_msgs/msg/String \"data: 'Hello'\"\n"})}),"\n",(0,r.jsx)(i.h3,{id:"topic-monitoring",children:"Topic Monitoring"}),"\n",(0,r.jsx)(i.p,{children:"Monitor topic performance:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Monitor topic rate\nros2 topic hz /topic_name\n\n# Monitor topic delay\nros2 topic delay /topic_name\n"})}),"\n",(0,r.jsx)(i.h2,{id:"advanced-communication-patterns",children:"Advanced Communication Patterns"}),"\n",(0,r.jsx)(i.h3,{id:"publisher-subscriber-best-practices",children:"Publisher-Subscriber Best Practices"}),"\n",(0,r.jsx)(i.h4,{id:"publisher-guidelines",children:"Publisher Guidelines"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Choose appropriate queue size based on message rate"}),"\n",(0,r.jsx)(i.li,{children:"Use appropriate QoS settings for your use case"}),"\n",(0,r.jsx)(i.li,{children:"Consider message size and frequency for bandwidth usage"}),"\n",(0,r.jsx)(i.li,{children:"Implement proper error handling"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"subscriber-guidelines",children:"Subscriber Guidelines"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Process messages efficiently to avoid queue overflow"}),"\n",(0,r.jsx)(i.li,{children:"Use appropriate QoS settings that match publishers"}),"\n",(0,r.jsx)(i.li,{children:"Consider using callback groups for complex nodes"}),"\n",(0,r.jsx)(i.li,{children:"Handle message timestamps appropriately"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"threading-and-callbacks",children:"Threading and Callbacks"}),"\n",(0,r.jsx)(i.p,{children:"ROS 2 provides different executors for handling callbacks:"}),"\n",(0,r.jsx)(i.h4,{id:"single-threaded-executor",children:"Single-threaded Executor"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"executor = SingleThreadedExecutor()\nexecutor.add_node(node)\nexecutor.spin()\n"})}),"\n",(0,r.jsx)(i.h4,{id:"multi-threaded-executor",children:"Multi-threaded Executor"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"executor = MultiThreadedExecutor(num_threads=4)\nexecutor.add_node(node)\nexecutor.spin()\n"})}),"\n",(0,r.jsx)(i.h3,{id:"callback-groups",children:"Callback Groups"}),"\n",(0,r.jsx)(i.p,{children:"Organize callbacks into groups for better control:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"# Create a callback group\ncallback_group = MutuallyExclusiveCallbackGroup()\n\n# Assign subscriptions to groups\nsubscription = self.create_subscription(\n    String,\n    'topic_name',\n    self.callback1,\n    10,\n    callback_group=callback_group\n)\n"})}),"\n",(0,r.jsx)(i.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(i.h3,{id:"message-optimization",children:"Message Optimization"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Use appropriate data types (avoid unnecessary precision)"}),"\n",(0,r.jsx)(i.li,{children:"Consider message compression for large data"}),"\n",(0,r.jsx)(i.li,{children:"Use efficient serialization methods"}),"\n",(0,r.jsx)(i.li,{children:"Minimize message copying"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"topic-design",children:"Topic Design"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Use descriptive topic names"}),"\n",(0,r.jsx)(i.li,{children:"Follow naming conventions"}),"\n",(0,r.jsx)(i.li,{children:"Consider message frequency vs. necessity"}),"\n",(0,r.jsx)(i.li,{children:"Design for loose coupling between nodes"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"memory-management",children:"Memory Management"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Monitor queue sizes to prevent memory issues"}),"\n",(0,r.jsx)(i.li,{children:"Use appropriate QoS settings for memory usage"}),"\n",(0,r.jsx)(i.li,{children:"Consider message lifecycle and cleanup"}),"\n",(0,r.jsx)(i.li,{children:"Profile memory usage in long-running systems"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,r.jsx)(i.h3,{id:"topic-connection-problems",children:"Topic Connection Problems"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Verify topic names match exactly"}),"\n",(0,r.jsx)(i.li,{children:"Check that nodes are on the same ROS domain"}),"\n",(0,r.jsx)(i.li,{children:"Ensure QoS profiles are compatible"}),"\n",(0,r.jsx)(i.li,{children:"Confirm nodes are running and properly initialized"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"message-loss",children:"Message Loss"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Increase queue size for high-frequency topics"}),"\n",(0,r.jsx)(i.li,{children:"Use appropriate reliability settings"}),"\n",(0,r.jsx)(i.li,{children:"Check network performance for distributed systems"}),"\n",(0,r.jsx)(i.li,{children:"Consider message priority and timing requirements"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Profile message rates and processing times"}),"\n",(0,r.jsx)(i.li,{children:"Optimize callback execution time"}),"\n",(0,r.jsx)(i.li,{children:"Use appropriate threading models"}),"\n",(0,r.jsx)(i.li,{children:"Consider using intra-process communication for same-process nodes"}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>c});var s=n(6540);const r={},l=s.createContext(r);function o(e){const i=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:i},e.children)}}}]);